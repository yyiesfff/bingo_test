# ğŸ—ï¸ æŠ€è¡“æ¶æ§‹è©³è§£

## ç³»çµ±æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç©å®¶è¨­å‚™å±¤ï¼ˆç”¨æˆ¶ç«¯ï¼‰                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚              â”‚              â”‚              â”‚              â”‚      â”‚
â”‚   ğŸ–¥ï¸ é›»è…¦A    â”‚   ğŸ“± æ‰‹æ©ŸB    â”‚   ğŸ“± æ‰‹æ©ŸC    â”‚   ğŸ“± å¹³æ¿C   â”‚      â”‚
â”‚  (ç€è¦½å™¨)    â”‚  (ç€è¦½å™¨)    â”‚  (ç€è¦½å™¨)    â”‚  (ç€è¦½å™¨)    â”‚      â”‚
â”‚   ç©å®¶ A      â”‚   ç©å®¶ B     â”‚   ç©å®¶ C     â”‚   ç©å®¶ D     â”‚      â”‚
â”‚              â”‚              â”‚              â”‚              â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                           â”‚  â”‚  â”‚  â”‚
                           â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ WebSocket
                           â”‚  â”‚  â”‚               é€£ç·š
                           â”‚  â”‚  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     é€šä¿¡å±¤ï¼ˆåŒæ­¥æ©Ÿåˆ¶ï¼‰                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  LocalStorage (DOM Storage)    Firebase Realtime Database      â”‚
â”‚  â”œâ”€ åŒä¸€è¨­å‚™è·¨åˆ†é åŒæ­¥          â”œâ”€ é›²ç«¯æ•¸æ“šå­˜å„²                â”‚
â”‚  â”œâ”€ æ¯«ç§’ç´šåŒæ­¥                  â”œâ”€ æ¯«ç§’ç´šé›™å‘åŒæ­¥              â”‚
â”‚  â””â”€ ç„¡ä¾è³´ï¼ˆå®Œå…¨æœ¬åœ°ï¼‰          â””â”€ æ”¯æŒç„¡é™ç©å®¶æ•¸é‡            â”‚
â”‚                                                                  â”‚
â”‚  éŠæˆ²æœƒè©± ID (Session ID)                                       â”‚
â”‚  â”œâ”€ è­˜åˆ¥æ¯ä¸€å±€éŠæˆ²                                             â”‚
â”‚  â”œâ”€ æ‰€æœ‰ç©å®¶å…±äº«åŒä¸€ ID                                        â”‚
â”‚  â””â”€ ç”Ÿæˆæ–¹å¼: session_[æ™‚é–“æˆ³]_[éš¨æ©Ÿå­—ä¸²]                      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚  â”‚  â”‚  â”‚
                           â†“  â†“  â†“  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Google Firebase é›²ç«¯ï¼ˆä¼ºæœå™¨ï¼‰                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  /games/${sessionId}/                                           â”‚
â”‚  â”œâ”€ gameSessionId: "session_xxx"                               â”‚
â”‚  â”œâ”€ sharedDrawnNums: [5, 23, 18, 42, ...]  (å·²é–‹è™Ÿç¢¼)         â”‚
â”‚  â”œâ”€ sharedDrawPool: [1, 2, 3, ...]  (å‰©é¤˜è™Ÿç¢¼)                â”‚
â”‚  â”œâ”€ participants:                                              â”‚
â”‚  â”‚  â”œâ”€ "ç©å®¶ A":                                               â”‚
â”‚  â”‚  â”‚  â”œâ”€ board: [12, 25, 33, ...]  (25 å€‹è™Ÿç¢¼)              â”‚
â”‚  â”‚  â”‚  â”œâ”€ winCount: 2  (é€£ç·šæ•¸)                               â”‚
â”‚  â”‚  â”‚  â””â”€ timestamp: ...                                      â”‚
â”‚  â”‚  â”‚                                                          â”‚
â”‚  â”‚  â””â”€ "ç©å®¶ B": {...}                                        â”‚
â”‚  â”‚                                                              â”‚
â”‚  â””â”€ updatedAt: "2024-02-16T10:30:45Z"                         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ ¸å¿ƒåŒæ­¥æµç¨‹

### æµç¨‹ 1ï¸âƒ£ï¼šç©å®¶é€²å…¥éŠæˆ²

```javascript
ç©å®¶è¼¸å…¥ã€Œåç¨±ã€ â†’ é»æ“Šã€Œé€²å…¥éŠæˆ²ã€
    â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  æª¢æŸ¥æœƒè©± ID                  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  æœ‰ç¾å­˜æœƒè©±?              â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†™             â†˜
          æ˜¯               å¦
         â”‚                 â”‚
         â†“                 â†“
    åŠ å…¥ç¾å­˜æœƒè©±      ç”Ÿæˆæ–°æœƒè©± ID
         â”‚                 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  ç”Ÿæˆå€‹äººæ£‹ç›¤ (24 å€‹éš¨æ©Ÿè™Ÿç¢¼)  â”‚
         â”‚  ä¸­å¿ƒ = ã€Œç™¼ã€(è‡ªå‹•æ¨™è¨˜)      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  åŠ è¼‰å…±äº«éŠæˆ²ç‹€æ…‹             â”‚
         â”‚  (å·²é–‹è™Ÿç¢¼ã€å‰©é¤˜è™Ÿç¢¼)        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  è¨­ç½® Firebase å¯¦æ™‚ç›£è½      â”‚
         â”‚  (æ¥æ”¶å…¶ä»–ç©å®¶çš„æ›´æ–°)        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  é¡¯ç¤ºéŠæˆ²é é¢                 â”‚
         â”‚  â”œâ”€ æœƒè©± ID                  â”‚
         â”‚  â”œâ”€ ç·šä¸Šç©å®¶åˆ—è¡¨             â”‚
         â”‚  â””â”€ è‡ªå·±çš„æ£‹ç›¤               â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æµç¨‹ 2ï¸âƒ£ï¼šæŠ½çƒè™Ÿï¼ˆæ ¸å¿ƒåŒæ­¥ï¼‰

```
ç©å®¶ A é»æ“Šã€ŒğŸ æŠ½çƒè™Ÿã€
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æœ¬åœ°ç‹€æ…‹æ›´æ–°                       â”‚
â”‚    - å¾ sharedDrawPool ç§»é™¤è™Ÿç¢¼      â”‚
â”‚    - åŠ å…¥ sharedDrawnNums           â”‚
â”‚    - é¡¯ç¤ºåœ¨æ£‹ç›¤ä¸Š                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æœ¬åœ°å­˜å„²åŒæ­¥                       â”‚
â”‚    - å¯«å…¥ localStorage               â”‚
â”‚    - è§¸ç™¼ storage äº‹ä»¶               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ (localStorage äº‹ä»¶ç›£è½)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. åŒé é¢å…¶ä»–åˆ†é æ”¶åˆ°               â”‚
â”‚    - ç©å®¶ Bï¼ˆå¦‚æœåœ¨åˆ†é  2ï¼‰         â”‚
â”‚    - è‡ªå‹•æ›´æ–°æ£‹ç›¤                   â”‚
â”‚    - æ¨™è¨˜æ–°è™Ÿç¢¼                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ (App.Core.syncGameState() å®šæœŸåŸ·è¡Œ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ä¸Šå‚³åˆ° Firebase                  â”‚
â”‚    - POST /games/session_xxx        â”‚
â”‚    - åŒ…å«æ‰€æœ‰éŠæˆ²ç‹€æ…‹               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ (Firebase å¯¦æ™‚æ¨é€)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ç©å®¶ Bï¼ˆæ‰‹æ©Ÿï¼‰æ¥æ”¶æ›´æ–°           â”‚
â”‚    - Firebase ç›£è½å™¨è§¸ç™¼            â”‚
â”‚    - æ›´æ–°æœ¬åœ°ç‹€æ…‹                   â”‚
â”‚    - é‡æ–°æ¸²æŸ“æ£‹ç›¤                   â”‚
â”‚    - æ¨™è¨˜æ–°è™Ÿç¢¼                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ•¸æ“šçµæ§‹

### ç©å®¶å€‹äººæ£‹ç›¤ (Participant)

```javascript
{
    "ç©å®¶åç¨±": {
        board: [
            5, 12, 23, 34, 45,
            8, 15, 24, 31, 40,
            3, 18, "FREE", 42, 50,
            // ... (24 å€‹è™Ÿç¢¼ + 1 å€‹ä¸­å¿ƒ)
        ],
        drawnNums: [],  // ç©å®¶å€‹äººçš„å·²é–‹æ•¸ (ä¸å¸¸ç”¨)
        winCount: 3     // ç›®å‰é”æˆçš„é€£ç·šæ•¸
    }
}
```

### å…±äº«éŠæˆ²ç‹€æ…‹ (Shared State)

```javascript
{
    gameSessionId: "session_1623456789_abc1234567",
    sharedDrawnNums: [23, 5, 42, 18, 34, ...],  // å…¨é«”ç©å®¶å…±äº«çš„å·²é–‹è™Ÿç¢¼
    sharedDrawPool: [1, 2, 3, 4, ...],          // å‰©é¤˜å¯æŠ½çš„è™Ÿç¢¼
    gameOver: false,                             // éŠæˆ²æ˜¯å¦çµæŸ
    participants: {
        "ç©å®¶ A": {...},
        "ç©å®¶ B": {...},
        "ç©å®¶ C": {...}
    },
    updatedAt: "2024-02-16T10:30:45Z"           // Firebase æ™‚é–“æˆ³
}
```

### LocalStorage çµæ§‹

```
localStorage:
â”œâ”€ bingo_users: ["ç©å®¶A", "ç©å®¶B", "ç©å®¶C"]
â”œâ”€ bingo_games: {
â”‚   "ç©å®¶A": { board: [...], winCount: 2 },
â”‚   "ç©å®¶B": { board: [...], winCount: 1 }
â”‚  }
â””â”€ bingo_shared_state: {
    drawnNums: [23, 5, 42, ...],
    drawPool: [1, 2, 3, ...]
   }

sessionStorage:
â””â”€ bingo_current_user: "ç©å®¶A"

localStorage (éŠæˆ²æœƒè©±):
â””â”€ bingo_session_id: "session_1623456789_abc1234567"
```

---

## äº‹ä»¶æµ

### 1. Storage äº‹ä»¶ï¼ˆåŒä¸€è¨­å‚™è·¨åˆ†é ï¼‰

```
åˆ†é  1 ä¿®æ”¹ localStorage
    â†“
è§¸ç™¼ storage äº‹ä»¶
    â†“
æ‰€æœ‰å…¶ä»–åˆ†é çš„ storage äº‹ä»¶ç›£è½å™¨åŸ·è¡Œ
    â†“
åˆ†é  2, 3, 4... è‡ªå‹•æ›´æ–°ç‹€æ…‹
```

**ä»£ç¢¼ä½ç½®**:
```javascript
window.addEventListener('storage', (event) => {
    if (event.key === 'bingo_shared_state') {
        // åŒæ­¥é ç¨‹ç‹€æ…‹åˆ°æœ¬åœ°
    }
});
```

### 2. Firebase å¯¦æ™‚ç›£è½ï¼ˆè·¨è¨­å‚™ï¼‰

```
Firebase Database æ•¸æ“šè®ŠåŒ–
    â†“
è§¸ç™¼æ‰€æœ‰ç›£è½è©²è·¯å¾‘çš„ callback
    â†“
æ‰€æœ‰å·²ç™»å…¥çš„è¨­å‚™åŒæ™‚æ”¶åˆ°æ›´æ–°
    â†“
æœ¬åœ°ç‹€æ…‹æ›´æ–°
    â†“
é‡æ–°æ¸²æŸ“ UI
```

**ä»£ç¢¼ä½ç½®**:
```javascript
db.ref(`games/${sessionId}`).on('value', (snapshot) => {
    const remoteData = snapshot.val();
    // åŒæ­¥é ç¨‹æ•¸æ“šåˆ°æœ¬åœ°
});
```

---

## åŒæ­¥å»¶é²åˆ†æ

| åŒæ­¥æ–¹å¼ | å»¶é²æ™‚é–“ | æ”¯æŒç¯„åœ | èªªæ˜ |
|--------|--------|--------|------|
| localStorage | 0-10 ms | åŒä¸€è¨­å‚™ | åŒæ­¥åˆ†é é–“çš„æ•¸æ“š |
| Firebase | 50-500 ms | å…¨çƒ | å–æ±ºæ–¼ç¶²è·¯é€Ÿåº¦å’Œè·é›¢ |
| å®šæ™‚åŒæ­¥ | 2000 ms | å…¨çƒ | App.Core.syncGameState() æ¯ 2 ç§’åŸ·è¡Œä¸€æ¬¡ |

**å„ªåŒ–å»ºè­°**:
```javascript
// ç›®å‰: æ¯ 2 ç§’åŒæ­¥ä¸€æ¬¡
setInterval(App.Core.syncGameState, 2000);

// å¯ä»¥æ”¹ç‚º: æ¯æ¬¡é‡è¦æ“ä½œç«‹å³åŒæ­¥
App.Actions.draw = function() {
    // ... æŠ½è™Ÿé‚è¼¯ ...
    App.Core.syncGameState();  // ç«‹å³åŒæ­¥
};
```

---

## é€£ç·šæª¢æŸ¥

### æª¢æŸ¥ Firebase é€£ç·šç‹€æ…‹

```javascript
db.ref('.info/connected').on('value', (snapshot) => {
    if (snapshot.val() === true) {
        console.log('âœ… å·²é€£æ¥ Firebase');
    } else {
        console.log('âŒ Firebase é€£æ¥ä¸­æ–·');
    }
});
```

### æª¢æŸ¥é ç¨‹æ›´æ–°

åœ¨ç€è¦½å™¨é–‹ç™¼è€…å·¥å…· (F12) Network æ¨™ç±¤è§€å¯Ÿï¼š
```
firebase.get /games/session_xxx HTTP/1.1
â†’ ç›£è½é ç¨‹æ•¸æ“šè®ŠåŒ–
```

---

## æ“´å±•æ€§åˆ†æ

### æ”¯æŒçš„æœ€å¤§ç©å®¶æ•¸

æ ¹æ“š Firebase å…è²»æ–¹æ¡ˆï¼š
- **åŒæ™‚é€£ç·š**: 100 å€‹è¨­å‚™
- **æ¯ç§’è®€å–**: 5000 æ¬¡
- **æ¯ç§’å¯«å…¥**: 1000 æ¬¡
- **å„²å­˜ç©ºé–“**: 1 GB

**å¯¦éš›é™åˆ¶**:
```
æ¯å€‹æŠ½è™Ÿæ“ä½œéœ€è¦:
â”œâ”€ 1 æ¬¡ write (æ›´æ–° sharedDrawnNums)
â”œâ”€ N æ¬¡ read (N å€‹ç©å®¶è®€å–æ›´æ–°)
â””â”€ 2 ç§’åŸ·è¡Œä¸€æ¬¡

æœ€å¤šæ”¯æŒ: 1000 writes/2sec = 500 writes/sec
æ¯ç§’æŠ½çƒæ•¸: ~500 å€‹æŠ½çƒæ“ä½œ
```

### å¯¦éš›å ´æ™¯

```
10 å€‹ç©å®¶ï¼Œæ¯äººæ¯åˆ†é˜æŠ½ 2 å€‹çƒ
= 20 å€‹æŠ½çƒæ“ä½œ/åˆ†é˜
= 0.33 å€‹æ“ä½œ/ç§’
= âœ… é é ä½æ–¼é™åˆ¶
```

---

## æ•…éšœæ¢å¾©æ©Ÿåˆ¶

### ç¶²è·¯ä¸­æ–·æ¢å¾©

```
ç¶²è·¯ä¸­æ–·
    â†“
æœ¬åœ°ç¹¼çºŒæ“ä½œï¼ˆå­˜å„²åœ¨ localStorageï¼‰
    â†“
ç¶²è·¯æ¢å¾©
    â†“
Firebase é€£ç·šé‡æ–°å»ºç«‹
    â†“
æœ¬åœ°ç‹€æ…‹èˆ‡ Firebase åŒæ­¥
    â†“
å…¶ä»–ç©å®¶æ”¶åˆ°æ›´æ–°
```

### æ•¸æ“šä¸€è‡´æ€§

ä½¿ç”¨ã€Œæ¨‚è§€æ›´æ–°ã€ç­–ç•¥ï¼š
```javascript
// ç«‹å³åœ¨æœ¬åœ°æ›´æ–°
App.State.sharedDrawnNums.push(num);
App.Actions.renderBoard();

// éåŒæ­¥ä¸Šå‚³åˆ° Firebase
App.Core.syncGameState();

// å¦‚æœä¸Šå‚³å¤±æ•—ï¼Œä¸‹æ¬¡åŒæ­¥æ™‚æœƒç³¾æ­£
```

---

## ç”Ÿç”¢ç’°å¢ƒæ³¨æ„äº‹é …

### å®‰å…¨æ€§

```javascript
// âŒ ä¸å®‰å…¨: å…è¨±ä»»ä½•äººè®€å¯«
{
  "rules": {
    ".read": true,
    ".write": true
  }
}

// âœ… å®‰å…¨: ä½¿ç”¨é©—è­‰
{
  "rules": {
    "games": {
      "$sessionId": {
        ".read": "auth != null",
        ".write": "auth != null"
      }
    }
  }
}
```

### é€Ÿç‡é™åˆ¶

é˜²æ­¢æ¿«ç”¨ï¼š
```javascript
const lastSyncTime = {};

function syncGameState() {
    const now = Date.now();
    const lastTime = lastSyncTime[App.State.gameSessionId] || 0;
    
    // æ¯æ¬¡åŒæ­¥é–“éš”è‡³å°‘ 500 ms
    if (now - lastTime < 500) {
        return;  // è·³éæœ¬æ¬¡åŒæ­¥
    }
    
    lastSyncTime[App.State.gameSessionId] = now;
    // åŸ·è¡ŒåŒæ­¥...
}
```

---

## åµéŒ¯æŠ€å·§

### 1. æª¢æŸ¥ Firebase æ•¸æ“š

```javascript
// åœ¨ç€è¦½å™¨æ§åˆ¶å°åŸ·è¡Œ
db.ref('games').on('value', console.log);
```

### 2. ç›£æ§åŒæ­¥æ“ä½œ

```javascript
// åœ¨ App.Core.syncGameState ä¸­æ·»åŠ 
console.log('åŒæ­¥æ™‚é–“:', new Date().toLocaleTimeString());
console.log('å·²é–‹è™Ÿç¢¼:', App.State.sharedDrawnNums);
console.log('ç·šä¸Šç©å®¶:', Object.keys(App.State.participants));
```

### 3. æª¢æŸ¥äº‹ä»¶ç›£è½å™¨

```javascript
// æŸ¥çœ‹è¨»å†Šçš„ç›£è½å™¨æ•¸é‡
console.log('ç›£è½å™¨æ•¸:', App.State.syncListeners.length);
```

---

ç¥ä½ é–‹ç™¼é †åˆ©ï¼ğŸš€
