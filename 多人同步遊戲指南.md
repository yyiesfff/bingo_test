# 🎮 Bingo 多人同步遊戲完整指南

## 📋 目錄
1. **同步原理** - 了解工作機制
2. **Firebase 設定** - 配置雲端聯動
3. **本地測試** - 在電腦上多人測試
4. **跨設備測試** - 手機電腦同步

---

## 🔄 同步原理

你的遊戲有 **3 層同步機制**：

### 層級 1️⃣：本地存儲 (localStorage)
```
┌─── 電腦A (瀏覽器分頁1)
│       ↕
│   localStorage
│       ↕
└─── 電腦A (瀏覽器分頁2)
```
- **用途**: 同一設備上不同瀏覽器分頁間的實時同步
- **速度**: ⚡ 極快（毫秒級）
- **範圍**: 只限同一設備

### 層級 2️⃣：遊戲會話 ID (Session Management)
```
所有 players 都用同一個 Session ID 識別一局遊戲
    ↓
遊戲會話 ID: session_1234567890_abcdefg
    ↓
所有玩家共享：已抽的號碼、抽籤池、連線紀錄
```

### 層級 3️⃣：Firebase Realtime Database (跨設備)
```
┌─── 電腦A (玩家 A)
│       │
│      ↓ 上傳狀態
│   
├── 🔥 Firebase Database 🔥  ← 雲端中樞
│
│      ↑ 下載狀態
│       │
└─── 手機B (玩家 B)
     └─ 平板C (玩家 C)
```
- **用途**: 不同設備間的實時同步
- **速度**: 🌐 毫秒級（網路速度決定）
- **費用**: 免費方案支持 100 個同時連線

---

## 🔧 設定步驟

### 第 1 步：建立 Firebase 專案

1. 訪問 **https://console.firebase.google.com**
2. 點擊「建立新專案」
   - 專案名稱: `FionasBingoGame`
   - 選擇或建立 Google Cloud 專案
   - 開啟 Google Analytics: ❌ 不用開

3. 建立完成後，點擊「</> 」建立 **Web 應用**
   - 應用暱稱: `Bingo Game`
   - 複製 **Firebase 配置物件**（非常重要！）

### 第 2 步：建立 Realtime Database

1. 左側選單 → 「建立資料庫」
2. 位置選擇: 亞太地區 (asia-southeast1)
3. 安全規則: **「以測試模式啟動」**
4. 點擊「啟用」

### 第 3 步：配置 Database 安全規則

進入「規則」分頁，貼上以下規則：

```json
{
  "rules": {
    "games": {
      "$sessionId": {
        ".read": true,
        ".write": true,
        ".indexOn": ["updatedAt"]
      }
    }
  }
}
```

✅ 點擊「發佈」

> ⚠️ 注意：此規則為測試模式，開放讀寫。
> 生產環境應加入身分驗證，避免被濫用。

### 第 4 步：更新遊戲配置

打開 `index.html`，找到以下代碼（約第 430 行）：

```javascript
const firebaseConfig = {
    apiKey: "AIzaSyDp_1234567890abcdefghijklmnopqrst",
    authDomain: "bingo-game-sync.firebaseapp.com",
    databaseURL: "https://bingo-game-sync-default-rtdb.firebaseio.com",
    projectId: "bingo-game-sync",
    storageBucket: "bingo-game-sync.appspot.com",
    messagingSenderId: "123456789012",
    appId: "1:123456789012:web:abcdefghijklmnopqrst"
};
```

**替換成 Firebase 控制台給你的配置**（第 1 步複製的）

---

## 🧪 測試指南

### 本地測試（同一電腦）

#### 方法 A：使用不同瀏覽器分頁

```
頁面 1（玩家 A）          頁面 2（玩家 B）
    ↓                          ↓
輸入「Alice」            輸入「Bob」
    ↓                          ↓
進入遊戲 ←── localStorage ──→ 進入遊戲
    ↓                          ↓
抽球號 ●                  自動顯示 ●
```

**步驟**:
1. 開啟 `index.html` 
2. 輸入「玩家 A」，點擊「進入遊戲」✅
3. **右鍵 → 「在新分頁開啟連結」** 開啟同一個頁面
4. 輸入「玩家 B」，點擊「進入遊戲」✅
5. 回到玩家 A 的分頁，點擊「🐎 抽球號」
6. 🎉 玩家 B 的棋盤會**自動同步**更新！

#### 方法 B：不同瀏覽器（Chrome + Edge）

1. Chrome 打開頁面 → 玩家 A
2. Edge 打開同一個 URL → 玩家 B
3. 兩個瀏覽器實時同步（透過 localStorage）

---

### 跨設備測試（手機 + 電腦）

#### 前置準備

你需要在電腦上架設一個簡單的 Web 伺服器：

**Windows PowerShell 方式**:
```powershell
cd c:\Users\FionaCheng\Downloads\bingo_test
python -m http.server 8000
```

或使用 Node.js：
```bash
npx http-server -p 8000
```

這樣你的遊戲就在: **http://localhost:8000/index.html**

#### 取得你的電腦 IP

**Windows PowerShell**:
```powershell
ipconfig | Select-String "IPv4"
```

找到形如 `192.168.1.XXX` 的地址

#### 連接手機

1. **手機 WiFi 連接到同一網路**
2. 手機瀏覽器打開: `http://192.168.1.XXX:8000`
3. 輸入玩家名稱登入
4. **電腦端已在遊戲** → 抽球號 → 👉 **手機自動同步！**

---

## 🚀 完整多人遊戲流程

### 遊戲開始

```
玩家 A（電腦）                    玩家 B（手機）
       ↓ 進入遊戲                      
玩家 A 看到                    玩家 B 看到
  會話 ID                        會話 ID
  session_xxx                   session_xxx
       │                              │
       └──────── 分享會話 ID ────────┘
                   📱 複製連結
                      或
                   手動輸入 ID
                      │
                      ↓
                   玩家 B 輸入會話 ID
                      ↓
                  加入同一局遊戲 ✅
```

### 遊戲進行

```
玩家 A 點擊 「🐎 抽球號」
    ↓
抽取號碼（例：23）
    ↓
上傳到 Firebase Database
    ↓
玩家 B 接收新號碼
    ↓
自動在棋盤標記 ✅
    ↓
顯示在「已開號碼紀錄」欄位
```

### 遊戲結束

```
玩家 B 完成 5 連線！
    ↓
彈出通知：「恭喜 玩家 B！目前已達成 5 條連線！🧧」
    ↓
遊戲數據保存到 Firebase
    ↓
遊戲統計自動更新
```

---

## 💡 新增功能說明

我在你的遊戲中新增了：

### ✨ 功能 1：會話 ID 顯示 + 複製

```
📌 遊戲會話
session_1623456789_abc1234567

[📋 複製]

分享會話 ID 給其他玩家加入本局
```

- 點擊「📋 複製」自動複製會話 ID
- 其他玩家可以粘貼會話 ID 加入同一局

### ✨ 功能 2：線上玩家列表

```
👥 線上玩家 (3)
👤 Alice    🏆 2 線
👤 Bob      🏆 1 線
👤 Carol    🏆 0 線
```

- 實時顯示所有玩家
- 顯示每個玩家的連線數
- 每 1 秒自動更新一次

### ✨ 功能 3：雲端同步 (Firebase)

- 自動將遊戲狀態上傳到 Firebase
- 其他設備實時接收更新
- 支持無限玩家數量（只要網路夠快）

---

## 🔐 常見問題

### Q1: 為什麼我設定好 Firebase 還是不同步？

**A**: 檢查以下幾點：
1. ✅ Firebase 配置是否正確複製到 `firebaseConfig` 物件
2. ✅ Realtime Database 安全規則是否發佈
3. ✅ 檢查瀏覽器控制台 (F12) 有無錯誤訊息
4. ✅ 確認 Firebase SDK 載入成功

### Q2: 沒有 Firebase 帳號，可以先測試嗎？

**A**: 可以！使用本地模式：
- 同一電腦上不同瀏覽器分頁 ✅
- 使用 `localStorage` 實時同步
- 不支持跨設備（需要 Firebase）

### Q3: 如何讓多玩家輪流抽號？

**A**: 目前設計是任何人都可以抽號。若要限制，可加入：
```javascript
// 在 draw() 函數開始時檢查
if (App.State.currentDrawer && App.State.currentDrawer !== App.State.currentUser) {
    alert('現在輪到 ' + App.State.currentDrawer + ' 抽號');
    return;
}
```

### Q4: 如何增加安全性防止不明人士加入？

**A**: 後續可加入：
1. 房間密碼驗證
2. 玩家名稱白名單
3. Firebase Authentication（推薦）

### Q5: 數據是否會保留？

**A**: 
- **localStorage**: 僅儲存在瀏覽器內，清除後消失
- **Firebase**: 除非手動刪除，否則永久保留

---

## 🎯 下一步優化建議

### 階段 1：基礎功能完善
- [ ] 加入房間密碼保護
- [ ] 玩家加入/離開通知
- [ ] 遊戲暫停功能
- [ ] 記錄遊戲歷史

### 階段 2：進階功能
- [ ] 多種棋盤大小（3x3, 5x5, 7x7）
- [ ] 自訂遊戲規則（數字範圍、連線方式）
- [ ] 玩家排行榜
- [ ] 聊天功能

### 階段 3：部署
- [ ] 部署到 Netlify / Vercel（免費）
- [ ] 建立專屬網址（非 localhost）
- [ ] 支持二維碼掃描加入遊戲
- [ ] 移動應用（React Native）

---

## 📱 快速分享方式

遊戲上線後，分享方式：

1. **直接分享網址**
   ```
   https://yoursite.com/bingo_test/index.html?sessionId=xxx
   ```

2. **分享會話 ID**
   ```
   📌 遊戲會話
   session_1623456789_abc1234567
   ```

3. **二維碼掃描**（未來功能）
   ```
   掃描二維碼 → 自動進入遊戲
   ```

---

## 📞 技術支持

如有問題，檢查：

1. **瀏覽器控制台** (F12 → Console 標籤)
   - 有無紅色錯誤訊息
   - Firebase 初始化訊息

2. **Network 標籤**
   - 確認 Firebase 連線正常
   - 查看請求 URL 是否正確

3. **Application 標籤**
   - 檢查 localStorage 中的數據
   - 檢查 sessionStorage 中的玩家信息

---

祝你遊戲進行順利！🎉
